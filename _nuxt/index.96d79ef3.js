import{a as _,o as r,b as c,e as t,t as i,F as p,r as f,f as h,h as g,w as S,v as I,p as b,i as y,c as T,j as C}from"./entry.b0f76dd6.js";function k(e){if(typeof e!="string")return;let o=new Date(e).getTime(),d=Math.floor((new Date-o)/1e3),a=d/31536e3;return a>1?Math.floor(a)+" years":(a=d/2592e3,a>1?Math.floor(a)+" months":(a=d/86400,a>1?Math.floor(a)+" days":(a=d/3600,a>1?Math.floor(a)+" hours":(a=d/60,a>1?Math.floor(a)+" minutes":Math.floor(d)+" seconds"))))}const M={props:{chatId:{type:String,default:null}},data(){return{room:null,message:null,mesageId:null}},computed:{messages(){return this.room.stories.edges},shortSenderName(){const e=this.room.roomName;return`${e.split(" ")[0]} ${e.split(" ")[1][0]}.`}},methods:{goBack(){this.$emit("goBack",!0)},getTimeSince(e){return k(e)},addMessageToChat(e){this.room.stories.edges.unshift({node:{createdDateTime:e.createRoomStory.createdDateTime,id:e.createRoomStory.id,message:this.message,messageId:this.messageId,storyTemplate:null,titleTemplate:null,user:{name:e.createRoomStory.user.name,photoUrl:e.createRoomStory.user.photoUrl,id:e.createRoomStory.user.id}}}),this.message="",this.messageId=null},sendMessage(){this.message&&(this.mesageId="id"+Math.random().toString(19).slice(2),fetch("https://8d0e-78-162-150-126.ngrok-free.app/rooms/"+this.chatId+"/stories",{method:"POST",headers:{"ngrok-skip-browser-warning":!0,Authorization:"Bearer oauth2v2_4ebae8c9336ae72076a77e30788c4be4","Content-Type":"application/json"},body:JSON.stringify({message:this.message,messageId:this.mesageId})}).then(e=>e.json()).then(e=>{e.data&&this.addMessageToChat(e.data)}).catch(e=>console.error(e)))}},mounted(){fetch("https://8d0e-78-162-150-126.ngrok-free.app/rooms/"+this.chatId+"/stories?"+new URLSearchParams({token:"Bearer oauth2v2_4ebae8c9336ae72076a77e30788c4be4"}),{method:"GET",headers:{"ngrok-skip-browser-warning":!0}}).then(e=>e.json()).then(e=>{var o;return this.room=(o=e==null?void 0:e.data)==null?void 0:o.room}).catch(e=>console.error(e))}},u=e=>(b("data-v-968aee0a"),e=e(),y(),e),$={key:0,class:"col-md-6 col-lg-7 col-xl-8"},N={class:"list-unstyled"},B={class:"font-weight-bold mb-3 text-center text-lg-start"},U=["src"],j={key:1,class:"card"},L={class:"card-header d-flex justify-content-between p-3"},R={class:"fw-bold mb-0 margin-right-5"},E={class:"text-muted small mb-0"},G=u(()=>t("i",{class:"far fa-clock"},null,-1)),V={class:"card-body"},D={class:"mb-0"},z={key:2,class:"card w-100"},A={class:"card-header d-flex justify-content-between p-3"},P={class:"fw-bold mb-0"},F={class:"text-muted small mb-0 margin-right-5"},J=u(()=>t("i",{class:"far fa-clock"},null,-1)),q={class:"card-body"},H={class:"mb-0"},K=["src"],O={class:"bg-white mb-3"},Q={class:"form-outline"},W=u(()=>t("label",{class:"form-label",for:"textAreaExample2"},"Message",-1)),X={key:1,id:"loading"};function Z(e,o,d,a,l,n){return l.room?(r(),c("div",$,[t("button",{class:"btn btn-info back-btn",onClick:o[0]||(o[0]=s=>n.goBack())},"Back"),t("ul",N,[t("h5",B,i(l.room.roomName),1),(r(!0),c(p,null,f(n.messages.slice().reverse(),s=>(r(),c("li",{class:"d-flex justify-content-between mb-4",key:s.node.messageId},[n.shortSenderName===s.node.user.name?(r(),c("img",{key:0,src:s.node.user.photoUrl,alt:"avatar",class:"rounded-circle d-flex align-self-start me-3 shadow-1-strong",width:"60",loading:"lazy"},null,8,U)):h("",!0),n.shortSenderName===s.node.user.name?(r(),c("div",j,[t("div",L,[t("p",R,i(s.node.user.name),1),t("p",E,[G,g(" "+i(n.getTimeSince(s.node.createdDateTime))+" ago ",1)])]),t("div",V,[t("p",D,i(s.node.message),1)])])):h("",!0),n.shortSenderName!==s.node.user.name?(r(),c("div",z,[t("div",A,[t("p",P,i(s.node.user.name),1),t("p",F,[J,g(" "+i(n.getTimeSince(s.node.createdDateTime))+" ago ",1)])]),t("div",q,[t("p",H,i(s.node.message),1)])])):h("",!0),n.shortSenderName!==s.node.user.name?(r(),c("img",{key:3,src:s.node.user.photoUrl,alt:"avatar",class:"rounded-circle d-flex align-self-start ms-3 shadow-1-strong",width:"60",loading:"lazy"},null,8,K)):h("",!0)]))),128)),t("li",O,[t("div",Q,[S(t("textarea",{class:"form-control",id:"textAreaExample2","onUpdate:modelValue":o[1]||(o[1]=s=>l.message=s),rows:"3"},null,512),[[I,l.message]]),W])]),t("button",{type:"button",class:"btn btn-primary btn-rounded float-end",onClick:o[2]||(o[2]=(...s)=>n.sendMessage&&n.sendMessage(...s))}," Send ")])])):(r(),c("div",X))}const w=_(M,[["render",Z],["__scopeId","data-v-968aee0a"]]);const Y={components:{chat:w},data(){return{selectedChatId:null,list:null}},mounted(){fetch("https://8d0e-78-162-150-126.ngrok-free.app/rooms?"+new URLSearchParams({token:"Bearer oauth2v2_4ebae8c9336ae72076a77e30788c4be4"}),{method:"GET",headers:{"ngrok-skip-browser-warning":!0}}).then(e=>e.json()).then(e=>{var o,d;return this.list=(d=(o=e==null?void 0:e.data)==null?void 0:o.roomList)==null?void 0:d.edges}).catch(e=>console.error(e))},methods:{getTimeSince(e){return k(e)},openChat(e){this.selectedChatId=e},clearSelectedChatId(){this.selectedChatId=null},truncateMessage(e="",o=50){return e.length>o?`${e.substring(0,o)}â€¦`:e}}},v=e=>(b("data-v-6478528f"),e=e(),y(),e),ee={class:"container py-5"},te={key:0,id:"loading"},se={key:1,class:"row"},oe={class:"col-md-6 col-lg-5 col-xl-4 mb-4 mb-md-0"},ae=v(()=>t("h5",{class:"font-weight-bold mb-3 text-center text-lg-start"},[t("img",{class:"up-logo",src:"https://upload.wikimedia.org/wikipedia/commons/thumb/d/d2/Upwork-logo.svg/2560px-Upwork-logo.svg.png",alt:"upwork-logo"})],-1)),ne={class:"list-unstyled mb-0"},re=["onClick"],ce={href:"#!",class:"d-flex justify-content-between"},de={class:"d-flex flex-row"},le=v(()=>t("img",{src:"https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQ_WKLL_EXzfrLt6V_ZHhmge50SCp_4MGRUgeyJyt0&s",alt:"avatar",class:"rounded-circle d-flex align-self-center me-3 shadow-1-strong",width:"60"},null,-1)),ie={class:"pt-1"},he={class:"fw-bold mb-0"},me={class:"small text-muted"},_e={class:"pt-1"},ue={class:"small text-muted mb-1 width-50"};function ge(e,o,d,a,l,n){const s=w;return r(),c("div",ee,[l.list?h("",!0):(r(),c("div",te)),l.selectedChatId?h("",!0):(r(),c("div",se,[t("div",oe,[ae,t("ul",ne,[(r(!0),c(p,null,f(l.list,m=>(r(),c("li",{key:m.id,class:"p-2 border-bottom up-chat-item",onClick:be=>n.openChat(m.node.id)},[t("a",ce,[t("div",de,[le,t("div",ie,[t("p",he,i(m.node.roomName),1),t("p",me,i(n.truncateMessage(m.node.latestStory.message)),1)])]),t("div",_e,[t("p",ue,i(n.getTimeSince(m.node.latestStory.createdDateTime)),1)])])],8,re))),128))])])])),l.selectedChatId?(r(),T(s,{key:2,chatId:l.selectedChatId,onGoBack:n.clearSelectedChatId},null,8,["chatId","onGoBack"])):h("",!0)])}const x=_(Y,[["render",ge],["__scopeId","data-v-6478528f"]]),pe={components:{chatList:x}};function fe(e,o,d,a,l,n){const s=x;return r(),c("main",null,[C(s)])}const ke=_(pe,[["render",fe]]);export{ke as default};
