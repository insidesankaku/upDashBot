import{a as _,o as d,b as r,e as t,t as i,F as g,r as p,f as h,h as f,w as x,v as C,p as b,i as y,c as I,j as T}from"./entry.b0cb7233.js";function w(e){if(typeof e!="string")return;let o=new Date(e).getTime(),c=Math.floor((new Date-o)/1e3),a=c/31536e3;return a>1?Math.floor(a)+" years":(a=c/2592e3,a>1?Math.floor(a)+" months":(a=c/86400,a>1?Math.floor(a)+" days":(a=c/3600,a>1?Math.floor(a)+" hours":(a=c/60,a>1?Math.floor(a)+" minutes":Math.floor(c)+" seconds"))))}const M={props:{chatId:{type:String,default:null}},data(){return{room:null,message:null,mesageId:null}},computed:{messages(){return this.room.stories.edges},shortSenderName(){const e=this.room.roomName;return`${e.split(" ")[0]} ${e.split(" ")[1][0]}.`}},methods:{goBack(){this.$emit("goBack",!0)},getTimeSince(e){return w(e)},addMessageToChat(e){this.room.stories.edges.unshift({node:{createdDateTime:e.createRoomStory.createdDateTime,id:e.createRoomStory.id,message:this.message,messageId:this.messageId,storyTemplate:null,titleTemplate:null,user:{name:e.createRoomStory.user.name,photoUrl:e.createRoomStory.user.photoUrl,id:e.createRoomStory.user.id}}}),this.message="",this.messageId=null},sendMessage(){this.message&&(this.mesageId="id"+Math.random().toString(19).slice(2),fetch("https://8d0e-78-162-150-126.ngrok-free.app/rooms/"+this.chatId+"/stories",{method:"POST",headers:{"ngrok-skip-browser-warning":!0,Authorization:"Bearer oauth2v2_5f556ea071736fb9d5e96a5f597c5be5","Content-Type":"application/json"},body:JSON.stringify({message:this.message,messageId:this.mesageId})}).then(e=>e.json()).then(e=>{e.data&&(this.addMessageToChat(e.data),this.$emit("messageSent",!0))}).catch(e=>console.error(e)))}},mounted(){fetch("https://8d0e-78-162-150-126.ngrok-free.app/rooms/"+this.chatId+"/stories?"+new URLSearchParams({token:"Bearer oauth2v2_5f556ea071736fb9d5e96a5f597c5be5"}),{method:"GET",headers:{"ngrok-skip-browser-warning":!0}}).then(e=>e.json()).then(e=>{var o;this.room=(o=e==null?void 0:e.data)==null?void 0:o.room,setTimeout(()=>{window.scrollTo(0,document.body.scrollHeight)})}).catch(e=>console.error(e))}},u=e=>(b("data-v-503e2f2d"),e=e(),y(),e),N={key:0,class:"col-md-6 col-lg-7 col-xl-8"},$={class:"up-sticky-header card-header d-flex justify-content-between align-items-center p-3 bg-info text-white border-bottom-0 mb-4"},U={class:"mb-0 fw-bold"},B=u(()=>t("i",{class:"fas fa-times",style:{visibility:"hidden"}},null,-1)),j={class:"list-unstyled"},L=["src"],R={key:1,class:"card"},G={class:"card-header d-flex justify-content-between p-3"},V={class:"fw-bold mb-0 margin-right-5"},D={class:"text-muted small mb-0"},E=u(()=>t("i",{class:"far fa-clock"},null,-1)),z={class:"card-body"},A={class:"mb-0"},P={key:2,class:"card w-100"},F={class:"card-header d-flex justify-content-between p-3"},H={class:"fw-bold mb-0"},J={class:"text-muted small mb-0 margin-right-5"},q=u(()=>t("i",{class:"far fa-clock"},null,-1)),K={class:"card-body"},O={class:"mb-0"},Q=["src"],W={class:"bg-white mb-3"},X={key:1,id:"loading"};function Z(e,o,c,a,l,n){return l.room?(d(),r("div",N,[t("div",$,[t("i",{class:"fas fa-angle-left",onClick:o[0]||(o[0]=s=>n.goBack())}),t("p",U,i(l.room.roomName),1),B]),t("ul",j,[(d(!0),r(g,null,p(n.messages.slice().reverse(),s=>(d(),r("li",{class:"d-flex justify-content-between mb-4",key:s.node.messageId},[n.shortSenderName===s.node.user.name?(d(),r("img",{key:0,src:s.node.user.photoUrl,alt:"avatar",class:"rounded-circle d-flex align-self-start me-3 shadow-1-strong",width:"60",loading:"lazy"},null,8,L)):h("",!0),n.shortSenderName===s.node.user.name?(d(),r("div",R,[t("div",G,[t("p",V,i(s.node.user.name),1),t("p",D,[E,f(" "+i(n.getTimeSince(s.node.createdDateTime))+" ago ",1)])]),t("div",z,[t("p",A,i(s.node.message),1)])])):h("",!0),n.shortSenderName!==s.node.user.name?(d(),r("div",P,[t("div",F,[t("p",H,i(s.node.user.name),1),t("p",J,[q,f(" "+i(n.getTimeSince(s.node.createdDateTime))+" ago ",1)])]),t("div",K,[t("p",O,i(s.node.message),1)])])):h("",!0),n.shortSenderName!==s.node.user.name?(d(),r("img",{key:3,src:s.node.user.photoUrl,alt:"avatar",class:"rounded-circle d-flex align-self-start ms-3 shadow-1-strong",width:"60",loading:"lazy"},null,8,Q)):h("",!0)]))),128)),t("li",W,[t("div",null,[x(t("textarea",{class:"form-control",id:"textAreaExample2","onUpdate:modelValue":o[1]||(o[1]=s=>l.message=s),placeholder:"Message",rows:"3"},null,512),[[C,l.message]])])]),t("button",{type:"button",class:"btn btn-info btn-rounded float-end mb-5",onClick:o[2]||(o[2]=(...s)=>n.sendMessage&&n.sendMessage(...s))}," Send ")])])):(d(),r("div",X))}const k=_(M,[["render",Z],["__scopeId","data-v-503e2f2d"]]);const Y={components:{chat:k},data(){return{selectedChatId:null,list:null,isNeedToUpdateChat:!1}},mounted(){this.loadChats()},methods:{loadChats(){fetch("https://8d0e-78-162-150-126.ngrok-free.app/rooms?"+new URLSearchParams({token:"Bearer oauth2v2_5f556ea071736fb9d5e96a5f597c5be5"}),{method:"GET",headers:{"ngrok-skip-browser-warning":!0}}).then(e=>e.json()).then(e=>{var o,c;return this.list=(c=(o=e==null?void 0:e.data)==null?void 0:o.roomList)==null?void 0:c.edges}).catch(e=>console.error(e))},getTimeSince(e){return w(e)},openChat(e){this.selectedChatId=e},clearSelectedChatId(){this.selectedChatId=null,this.isNeedToUpdateChat&&(this.list=null,this.isNeedToUpdateChat=!1,this.loadChats())},truncateMessage(e="",o=50){return e.length>o?`${e.substring(0,o)}â€¦`:e},updateChat(){this.isNeedToUpdateChat=!0}}},v=e=>(b("data-v-c0667a6d"),e=e(),y(),e),ee={class:"container py-3"},te={key:0,id:"loading"},se={key:1,class:"row"},oe={class:"col-md-6 col-lg-5 col-xl-4 mb-4 mb-md-0"},ae=v(()=>t("h5",{class:"font-weight-bold mb-3 text-center text-lg-start"},[t("img",{class:"up-logo",src:"https://upload.wikimedia.org/wikipedia/commons/thumb/d/d2/Upwork-logo.svg/2560px-Upwork-logo.svg.png",alt:"upwork-logo"})],-1)),ne={class:"list-unstyled mb-0"},de=["onClick"],re={href:"#!",class:"d-flex justify-content-between"},ce={class:"d-flex flex-row"},le=v(()=>t("img",{src:"https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQ_WKLL_EXzfrLt6V_ZHhmge50SCp_4MGRUgeyJyt0&s",alt:"avatar",class:"rounded-circle d-flex align-self-center me-3 shadow-1-strong",width:"60"},null,-1)),ie={class:"pt-1"},he={class:"fw-bold mb-0"},me={class:"small text-muted"},_e={class:"pt-1"},ue={class:"small text-muted mb-1 width-60"},fe={key:0,class:"badge bg-danger float-end"};function ge(e,o,c,a,l,n){const s=k;return d(),r("div",ee,[l.list?h("",!0):(d(),r("div",te)),l.selectedChatId?h("",!0):(d(),r("div",se,[t("div",oe,[ae,t("ul",ne,[(d(!0),r(g,null,p(l.list,m=>(d(),r("li",{key:m.id,class:"p-2 border-bottom up-chat-item",onClick:ye=>n.openChat(m.node.id)},[t("a",re,[t("div",ce,[le,t("div",ie,[t("p",he,i(m.node.roomName),1),t("p",me,i(n.truncateMessage(m.node.latestStory.message)),1)])]),t("div",_e,[t("p",ue,i(n.getTimeSince(m.node.latestStory.createdDateTime)),1),m.node.numUnread>0?(d(),r("span",fe,i(m.node.numUnread),1)):h("",!0)])])],8,de))),128))])])])),l.selectedChatId?(d(),I(s,{key:2,chatId:l.selectedChatId,onGoBack:n.clearSelectedChatId,onMessageSent:n.updateChat},null,8,["chatId","onGoBack","onMessageSent"])):h("",!0)])}const S=_(Y,[["render",ge],["__scopeId","data-v-c0667a6d"]]),pe={components:{chatList:S}};function be(e,o,c,a,l,n){const s=S;return d(),r("main",null,[T(s)])}const ke=_(pe,[["render",be]]);export{ke as default};
